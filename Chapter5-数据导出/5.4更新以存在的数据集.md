<h2>5.4更新以存在的数据集</h2>

<h3>问题</h3>
以前从 Hadoop 导出了数据在此之后, 运行了更改它的其他处理。宁愿只更新任何已更改的行, 而不是清除数据库中
的现有数据。

<h3>解决方案</h3>

可以利用将发布更新而不是插入语句的更新功能。更新模式是使用参数**--update-key** (包含可标识已更改行的列
的名称) 激活的, 通常是表的主键。例如, 下面的命令允许使用表城市的列 id:

```
sqoop export \
--connect jdbc:mysql://mysql.example.com/sqoop \
--username sqoop \
--password sqoop \
--table cities \
--update-key id
Discussion
```

<h3>讨论</h3>
该参数用于指示Sqoop更新现有行, 而不是插入新行时。此参数要求使用逗号分隔的列列表, 该表应用于唯一标识行。所有这些列将在生成的更新查询的where子句
中使用。所有其他表列将在查询的 SET 部分中使用。例如, 对于包含四列 (c1、c2、c3 和 c4) 的表, 用 update 键 Sqoop 调用 c2,c4 将生成以下更新查询。

```
UPDATE table SET c1 = ?, c3 = ? WHERE c2 = ? and c3 = ？
```

了解查询的结构非常重要, 以查看更新模式将如何从 Hadoop 导出数据。
首先, 用于标识行的列将永远不会更新, 因为它们不是 SET 子句的一部分。
此外, 如果 Hadoop 中的数据包含一些完全新的行, where 子句将不匹配数据库端的任何行。在数据库端进行这样的操作是完全有效的, 但不会导致更新的行。
因此, 不导出新行。



